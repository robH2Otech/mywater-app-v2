
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper functions for security
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // TEMPORARILY SIMPLIFIED RULES FOR DEBUGGING
    // Business users collection - allow authenticated users to access their own documents
    match /app_users_business/{userId} {
      // Allow authenticated users to read any document (for migration purposes)
      allow read: if isAuthenticated();
      
      // Allow users to create/update their own document or any document during setup
      allow create, update: if isAuthenticated();
      
      // Allow deletion by authenticated users (will restrict later)
      allow delete: if isAuthenticated();
    }
    
    // Private users collection - allow authenticated access
    match /app_users_privat/{userId} {
      allow read, write: if isAuthenticated();
    }
    
    // All other collections - allow authenticated access for now
    match /units/{unitId} {
      allow read, write: if isAuthenticated();
    }
    
    match /measurements/{measurementId} {
      allow read, write: if isAuthenticated();
    }
    
    match /alerts/{alertId} {
      allow read, write: if isAuthenticated();
    }
    
    match /client_requests/{requestId} {
      allow read, write: if isAuthenticated();
    }
    
    match /locations/{locationId} {
      allow read, write: if isAuthenticated();
    }
    
    match /filters/{filterId} {
      allow read, write: if isAuthenticated();
    }
    
    match /reports/{reportId} {
      allow read, write: if isAuthenticated();
    }
    
    // Audit logs - allow creation for now
    match /audit_logs/{logId} {
      allow read, create: if isAuthenticated();
      allow update, delete: if false;
    }
    
    // Deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
